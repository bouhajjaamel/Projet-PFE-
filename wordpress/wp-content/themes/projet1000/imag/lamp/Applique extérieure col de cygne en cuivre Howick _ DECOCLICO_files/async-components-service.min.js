!function(){"use strict";angular.module("async.components.service",[]).factory("AsyncComponentsService",["$rootScope","$timeout","$location","toastr","AppService","ModalService","RoutesService","LoadService",function(s,y,m,f,C,q,p,T){return{initAddToCartQuantity:function(e,t){var o,a,u=!0,n=null;function r(t){e.cartQuantity=t,e.quantity=t,e.isInCart=0<t,e.showLoader=!1,e.ready=!0,e.isProductButton&&(e.js=e.productCtrl.js,T.getService("AsyncProductService",{ctrl:e},"buttonSetItemQuantity"))}function i(t){return c(),""===t?t:(t=parseInt(t),isNaN(t)?t=0:t<0?t=0:t)}function c(){e.isChanged||(e.isChanged=!0,n=t.$watch("$ctrl.quantity",l))}function l(t,a,i,n){if(n=n||800,e.active=0<e.quantity||""===e.quantity,y.cancel(o),""===e.quantity||e.quantity===e.cartQuantity)return!1;o=y(function(){e.isModalButton&&e.modalItem&&(e.price.prices=e.modalItem.prices,e.modalItem.Price=C.getProductPrice(e.price,e.quantity),e.modalItem.quantity=e.quantity,0===e.quantity&&q.close());var t,a,i=(100*e.quantity-100*e.cartQuantity)/100;e.cartQuantity=i,void 0!==e.action?e.addToCart(e.action({qty:e.quantity,inc:i}),e.quantity):e.addToCart((t=e.quantity,a=i,[{idLine:e.idLine,Comment:e.commentLine||"",idProduct:e.id,Price:C.getProductPrice(e.price,t),costTTC:0,costHT:0,showTTCPrice:u,quantity:a,designation:e.designation,img:e.img,URL:e.url}]),e.quantity),o=null},n,!1)}function d(t,a){if(s.$broadcast("cartUpdating"),e.showLoader=!0,e.posLoader=e.cartQuantity<0?"left":"",e.isCartButton||e.isInCart||m.path()==="/"+p.getUrlByName("Cart")){e.isModalButton||q.close();var i=0===a?e.titleDeleteOk:e.titleModifyOk;f.success(e.designation,i,{allowHtml:!0,extraData:{template:"toast_addtocart.tpl",data:{img:t[0].img}}})}else q.close(),q.show("/Template/Modal/ModalAddToCart",t,null,"modalAddToCartCtrl",null,null,{cartLink:"/"+p.getUrlByName("Cart")});C.addToCart(t).then(function(t){e.showLoader=!1,"OK"===t.status?C.updateParams(t.results):C.getTranslate().then(function(t){f.warning(t.errors.TryLater,t.errors.ErrorHasOccurred,{allowHtml:!0,extraData:{template:"toast_message.tpl"}})})}).catch(function(t){})}(function(){void 0===e.addToCartActive&&(e.addToCartActive=!0);e.productQuantity&&r(e.productQuantity);e.isProductButton&&(e.defaultTooltip=e.tooltip,t.$on("updateTooltip",function(t,a){e.tooltip=a||e.defaultTooltip}),t.$on("updateComment",function(t,a){e.commentLine=a,C.itemQuantityInCart(e.id,e.commentLine||"").then(function(t){r(t)}).catch(function(t){})}));e.isModalButton&&(e.showLoader=!0);C.getParams().then(function(t){u=t.Visitor.CardType.ShowTTCPrice}).catch(function(t){})})(),e.$onDestroy=function(){n&&n()},e.openQuickView=function(){q.show("/Template/Modal/ModalQuickView",{url:e.url,windowClass:"modal-quick-view"},"lg","modalQuickViewCtrl",null,e.device,null)},e.addToCart=function(a,i){a&&(e.isCartButton&&a[0].quantity<0?C.itemQuantityInCart(e.id).then(function(t){t===-1*a[0].quantity?(n(),q.show("/Template/Cart/ModalDeleteConfirm",{action:function(){C.deleteLine(e.idLine,e.designation,e.img,e.titleDeleteOk)},cancel:function(){r(t),e.isChanged=!1,c()}},null,"deleteConfirmModalCtrl")):d(a,i)}).catch(function(t){}):d(a,i))},e.minus=function(){e.quantity=i(e.quantity-1)},e.plus=function(){e.addToCartActive&&(e.quantity=i(e.quantity+1))},e.changed=function(){e.quantity=i(e.quantity)},e.blurred=function(){e.quantity=i(e.quantity),y.cancel(a),a=y(function(){e.quantity=""===e.quantity?e.cartQuantity:e.quantity},2e3,!0)}},initAddToCartCustom:function(n,t){var a,e=!0;function o(t){q.close(),q.show("/Template/Modal/ModalAddToCart",t,null,"modalAddToCartCtrl",null,null,{cartLink:"/"+p.getUrlByName("Cart")},null,function(){n.quantity=1}),C.addToCart(t).then(function(t){"OK"===t.status?C.updateParams(t.results):C.getTranslate().then(function(t){f.warning(t.errors.TryLater,t.errors.ErrorHasOccurred,{allowHtml:!0,extraData:{template:"toast_message.tpl"}})})}).catch(function(t){})}(function(){n.quantity=1,n.minusDisabled=!0,void 0===n.addToCartActive&&(n.addToCartActive=!0);n.isProductButton&&(n.defaultTooltip=n.tooltip,t.$on("updateTooltip",function(t,a){n.tooltip=a||n.defaultTooltip}),t.$on("updateComment",function(t,a){n.commentLine=a}));n.ready=!0,C.getParams().then(function(t){e=t.Visitor.CardType.ShowTTCPrice}).catch(function(t){})})(),n.openQuickView=function(){q.show("/Template/Modal/ModalQuickView",{url:n.url,windowClass:"modal-quick-view"},"lg","modalQuickViewCtrl",null,n.device,null)},n.focus=function(){a=n.quantity,n.quantity=""},n.blur=function(){""===n.quantity&&(n.quantity=a)},n.keypress=function(t){13===t.keyCode&&($(t.target).blur(),n.addToCart())},n.change=function(){""!==n.quantity&&(isNaN(parseInt(n.quantity))||n.quantity<1?n.quantity=a:(n.quantity=parseInt(n.quantity),a=n.quantity,n.minusDisabled=1===n.quantity))},n.minus=function(){1<n.quantity&&(n.quantity=n.quantity-1,n.minusDisabled=1===n.quantity)},n.plus=function(){n.addToCartActive&&(n.quantity=n.quantity+1,n.minusDisabled=1===n.quantity)},n.addToCart=function(){var t;if(n.addToCartActive)if(n.quantity="0"===n.quantity?1:parseInt(n.quantity),void 0!==n.action){var a=n.action({qty:n.quantity,inc:n.quantity});_.each(a,function(t){t.fromClassicBtn=!0,t.idStatus=n.idStatus,t.availableQuantity=n.availableQuantity,t.availability=n.availability,t.restock=7!==n.idStatus&&10!==n.idStatus&&2!==n.idStatus}),o(a,n.quantity)}else{var i=n.quantity;o((t=i,[{idLine:n.idLine,Comment:n.commentLine||"",idProduct:n.id,idStatus:n.idStatus,availableQuantity:n.availableQuantity,availability:n.availability,restock:7!==n.idStatus&&10!==n.idStatus&&2!==n.idStatus,Price:C.getProductPrice(n.price,t),costTTC:0,costHT:0,showTTCPrice:e,quantity:t,designation:n.designation,img:n.img,URL:n.url,fromClassicBtn:!0}]))}}},initDelete:function(t){t.delete=function(){q.show("/Template/Cart/ModalDeleteConfirm",{action:function(){C.deleteLine(t.idLine,t.designation,t.img,t.titleDeleteOk,!0)}},null,"deleteConfirmModalCtrl")}},initModify:function(i){i.addToCart=function(){var a=i.productCtrl.getProductsToAdd(i.modalCtrl.quantity,0);a[0].idLine=i.modalCtrl.idLine,i.modalCtrl.showLoader=!0,C.addToCart(a).then(function(t){i.modalCtrl.showLoader=!1,"OK"===t.status?(C.updateParams(t.results),f.success(i.designation,i.titleModifyOk,{allowHtml:!0,extraData:{template:"toast_addtocart.tpl",data:{img:a[0].img}}}),q.close()):C.getTranslate().then(function(t){f.warning(t.errors.TryLater,t.errors.ErrorHasOccurred,{allowHtml:!0,extraData:{template:"toast_message.tpl"}})}).catch(function(t){})})}}}}])}();